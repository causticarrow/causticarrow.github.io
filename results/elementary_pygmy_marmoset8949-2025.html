<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Results - causticarrow.com</title>
    <link rel="stylesheet" href="../style.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
  <body>
    <div class="container">
      <aside class="sidebar">
        <input type="text" class="search-bar" placeholder="Search" />
        <ul>
          <li><a href="../index.html">Home</a></li>
          <li><a href="https://x.com/causticarrow">ùïè (Twitter)</a></li>
          <li class="category-header">
            <span class="category-toggle">Results</span>
            <ul class="category-content" id="results-list"></ul>
          </li>
        </ul>
      </aside>
      <main class="main-content">
        <h1 id="pageHeader">Results</h1>
        <div id="chart-container" style="width: 100%; height: 300px">
          <canvas id="myChart" style="width: 100%; height: 300px"></canvas>
        </div>
        <table class="summary-table">
          <thead>
            <tr>
              <th>n</th>
              <th>Record</th>
              <th>Units</th>
              <th>ROI</th>
              <th>BTCL</th>
              <th>No-Vig CLV</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td id="n"></td>
              <td id="record"></td>
              <td id="units"></td>
              <td id="roi"></td>
              <td id="btcl"></td>
              <td id="noVigClv"></td>
            </tr>
          </tbody>
        </table>
        <table class="detailed-table">
          <thead>
            <tr>
              <th>Date</th>
              <th>Play</th>
              <th>Result</th>
              <th>Units</th>
              <th>Score</th>
              <th>Close</th>
              <th>No-Vig CLV</th>
            </tr>
          </thead>
          <tbody id="resultsTableBody"></tbody>
        </table>
      </main>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Configuration - Update these values for each page
        var config = {
          name: "elementary_pygmy_marmoset8949", // The bettor's name/handle
          year: "2025", // The year/season
          sport: "NFL", // The sport/league
        };

        var data = [
          {
            date: "2025-09-16",
            sport: "NFL",
            play: "Tetairoa McMillan to win OROY (+700)",
            result: "Pending",
            score: "Pending",
            close: "‚Äî",
            clv: "0",
          },
          {
            date: "2025-09-15",
            sport: "NFL",
            play: "Justin Herbert Over 227.5 Passing Yards (-115)",
            result: "Win",
            score: "242",
            close: "‚Äî",
            clv: "0",
          },
          {
            date: "2025-09-15",
            sport: "NFL",
            play: "Tyler Conklin Under 10.5 Longest Reception (-125)",
            result: "Win",
            score: "0",
            close: "‚Äî",
            clv: "0",
          },
        ];

        // -------------------------
        // Sidebar auto-loader
        // -------------------------
        async function populateSidebar() {
          const ul = document.getElementById("results-list");
          ul.innerHTML = "";

          try {
            const response = await fetch("results.json");
            const pages = await response.json();

            const currentPage = window.location.pathname.split("/").pop();

            pages.forEach((p) => {
              const li = document.createElement("li");
              const a = document.createElement("a");
              a.href = p.file;
              a.textContent = p.label;

              // Highlight current page
              if (p.file === currentPage) {
                a.classList.add("active");
              }

              li.appendChild(a);
              ul.appendChild(li);
            });
          } catch (err) {
            console.error("Could not load results.json", err);
          }
        }

        // -------------------------
        // Title/Header
        // -------------------------
        function setTitleAndHeader() {
          var title =
            config.name +
            "'s " +
            config.year +
            " " +
            config.sport +
            " Results - causticarrow.com";
          var header = config.year + " " + config.sport + " (" + config.name + ")";

          document.title = title;
          document.getElementById("pageHeader").textContent = header;
        }

        // -------------------------
        // Search filter
        // -------------------------
        function filterSidebar() {
          var input, filter, ul, li, i;
          input = document.querySelector(".search-bar");
          filter = input.value.toUpperCase();
          ul = document.querySelector(".sidebar ul");
          li = ul.getElementsByTagName("li");

          for (i = 0; i < li.length; i++) {
            var a = li[i].getElementsByTagName("a")[0];
            if (a) {
              var txtValue = li[i].textContent || li[i].innerText;
              if (txtValue.toUpperCase().indexOf(filter) > -1) {
                li[i].style.display = "";
              } else {
                var shouldHide = true;
                li[i].querySelectorAll("*").forEach((node) => {
                  if (
                    (node.textContent || node.innerText)
                      .toUpperCase()
                      .indexOf(filter) > -1
                  ) {
                    shouldHide = false;
                  }
                });
                li[i].style.display = shouldHide ? "none" : "";
              }
            }
          }
        }

        // -------------------------
        // Units & Risk Calculations
        // -------------------------
        function calculateUnits(row) {
          if (row.result === "Win") {
            return 1;
          } else if (row.result === "Loss") {
            if (row.play.includes("(")) {
              var oddsMatch = row.play.match(/\(([-+]?\d+(?:\.\d+)?)\)/);
              if (oddsMatch) {
                var odds = parseFloat(oddsMatch[1]);
                if (odds > 0) {
                  return -(100 / odds);
                } else {
                  return -(Math.abs(odds) / 100);
                }
              } else {
                return -1.1;
              }
            } else {
              return -1.1;
            }
          } else if (row.result === "Pending") {
            return null;
          } else {
            return 0;
          }
        }

        function calculateRisk(row) {
          if (row.play.includes("(")) {
            var oddsMatch = row.play.match(/\(([-+]?\d+(?:\.\d+)?)\)/);
            if (oddsMatch) {
              var odds = parseFloat(oddsMatch[1]);
              if (odds > 0) {
                return odds / 100;
              } else {
                return Math.abs(odds) / 100;
              }
            } else {
              return 1.1;
            }
          } else {
            return 1.1;
          }
        }

        function formatValue(value, isPercentage = false) {
          if (value === null) {
            return "‚Äî";
          }
          if (isPercentage) {
            if (value === 0) {
              return "‚Äî";
            }
            return value > 0
              ? `+${value.toFixed(2)}%`
              : value < 0
              ? `${value.toFixed(2)}%`
              : "0.00%";
          } else {
            return value > 0
              ? `+${value.toFixed(2)}`
              : value < 0
              ? `${value.toFixed(2)}`
              : "0.00";
          }
        }

        // -------------------------
        // Summary Table
        // -------------------------
        function updateSummaryTable() {
          let wins = 0,
            losses = 0,
            pushes = 0,
            totalUnits = 0,
            positiveClv = 0,
            totalClv = 0,
            totalRisked = 0;

          data.forEach((row) => {
            if (row.result === "Win") {
              wins++;
              totalUnits += calculateUnits(row);
            } else if (row.result === "Loss") {
              losses++;
              totalUnits += calculateUnits(row);
            } else if (row.result === "Push") {
              pushes++;
            }
            if (row.result !== "Pending") {
              totalRisked += calculateRisk(row);
              let clvValue = parseFloat(row.clv.replace("%", ""));
              if (clvValue > 0) positiveClv++;
              totalClv += clvValue;
            }
          });

          let nElement = document.getElementById("n");
          let recordElement = document.getElementById("record");
          let unitsElement = document.getElementById("units");
          let roiElement = document.getElementById("roi");
          let btclElement = document.getElementById("btcl");
          let noVigClvElement = document.getElementById("noVigClv");

          if (nElement) nElement.textContent = data.length;
          if (recordElement)
            recordElement.textContent = `${wins} - ${losses} - ${pushes} (${(
              (wins / (wins + losses)) *
              100
            ).toFixed(2)}%)`;

          if (unitsElement) {
            unitsElement.textContent = formatValue(totalUnits);
            unitsElement.style.color =
              totalUnits > 0
                ? "#1ea672"
                : totalUnits < 0
                ? "#ff5252"
                : "#8c99ad";
          }

          if (roiElement) {
            let roi = (totalUnits / totalRisked) * 100;
            roiElement.textContent = formatValue(roi, true);
            roiElement.style.color =
              roi > 0 ? "#1ea672" : roi < 0 ? "#ff5252" : "#8c99ad";
          }

          let settledBetsCount = data.filter(
            (row) => row.result !== "Pending"
          ).length;
          let btclPercent =
            settledBetsCount > 0 ? (positiveClv / settledBetsCount) * 100 : 0;
          if (btclElement) {
            if (btclPercent === 0) {
              btclElement.textContent = "‚Äî";
            } else {
              btclElement.textContent = `${btclPercent.toFixed(2)}%`;
            }
          }

          if (noVigClvElement) {
            let avgClv =
              settledBetsCount > 0 ? totalClv / settledBetsCount : 0;
            noVigClvElement.textContent = formatValue(avgClv, true);
            noVigClvElement.style.color =
              avgClv > 0 ? "#1ea672" : avgClv < 0 ? "#ff5252" : "#8c99ad";
          }
        }

        // -------------------------
        // Detailed Table
        // -------------------------
        function populateDetailedTable() {
          let tbody = document.getElementById("resultsTableBody");
          tbody.innerHTML = "";

          data.sort((a, b) => new Date(b.date) - new Date(a.date));

          data.forEach((row) => {
            let units = calculateUnits(row);
            let tr = document.createElement("tr");
            let unitColor = "#8c99ad";
            let formattedUnits = formatValue(units);

            if (units !== null) {
              unitColor =
                units > 0 ? "#1ea672" : units < 0 ? "#ff5252" : "#8c99ad";
              if (formattedUnits === "0.00") {
                unitColor = "#8c99ad";
              }
            }

            let clvValue = parseFloat(row.clv.replace("%", ""));
            let formattedClv = formatValue(clvValue, true);
            let clvColor =
              clvValue > 0 ? "#1ea672" : clvValue < 0 ? "#ff5252" : "#8c99ad";

            tr.innerHTML = `
              <td style="color: #8c99ad; text-align: center;">
                <span class="date">${row.date}</span>${row.sport}
              </td>
              <td style="color: #8c99ad;">${row.play}</td>
              <td style="color: ${
                row.result === "Win"
                  ? "#1ea672"
                  : row.result === "Loss"
                  ? "#ff5252"
                  : "#8c99ad"
              }; text-align: center;">${row.result}</td>
              <td style="color: ${unitColor}; text-align: center;">${formattedUnits}</td>
              <td style="color: #8c99ad; text-align: center;">${row.score}</td>
              <td style="color: #8c99ad; text-align: center;">${row.close}</td>
              <td style="color: ${clvColor}; text-align: right;">${formattedClv}</td>
            `;
            tbody.appendChild(tr);
          });
        }

        // -------------------------
        // Chart
        // -------------------------
        function createSimpleChart() {
          var chartData = data.reduce((acc, row) => {
            var date = new Date(row.date);
            var dateString = date.toISOString().split("T")[0];
            if (!acc[dateString]) {
              acc[dateString] = { date: date, units: 0 };
            }
            acc[dateString].units += calculateUnits(row) || 0;
            return acc;
          }, {});

          var chartDataArray = Object.values(chartData).sort(
            (a, b) => a.date - b.date
          );
          var labels = ["\u00A0"].concat(
            chartDataArray.map((item) => {
              var date = new Date(item.date);
              return `${date.toLocaleString("en-US", {
                month: "short",
              })} ${date.getUTCDate()}`;
            })
          );
          var cumulativeUnits = chartDataArray.reduce(
            (cumulative, item, index) => {
              var total =
                index === 0
                  ? item.units
                  : cumulative[cumulative.length - 1] + item.units;
              cumulative.push(total);
              return cumulative;
            },
            [0]
          );

          var ctx = document.getElementById("myChart").getContext("2d");
          window.myChart = new Chart(ctx, {
            type: "line",
            data: {
              labels: labels,
              datasets: [
                {
                  label: "Cumulative Units",
                  data: cumulativeUnits,
                  borderColor: "rgba(0, 128, 128, 1)",
                  backgroundColor: "rgba(0, 128, 128, 0.2)",
                  fill: true,
                  lineTension: 0,
                  pointRadius: 0,
                  pointStyle: "circle",
                  pointBackgroundColor: "#1ea672",
                  pointBorderColor: "#1ea672",
                  pointBorderWidth: 1,
                  pointHoverRadius: 3,
                  pointHoverBackgroundColor: "#1ea672",
                  pointHoverBorderColor: "#1ea672",
                  pointHoverBorderWidth: 2,
                  responsive: true,
                },
              ],
            },
            options: {
              scales: {
                x: { display: false, grid: { display: false } },
                y: { display: true, grid: { display: false } },
              },
              plugins: {
                legend: { display: false },
                tooltip: {
                  mode: "index",
                  intersect: false,
                  displayColors: false,
                  callbacks: {
                    title: function (tooltipItems) {
                      if (tooltipItems[0].dataIndex === 0) {
                        return "\u00A0";
                      }
                      var date = new Date(
                        chartDataArray[tooltipItems[0].dataIndex - 1].date
                      );
                      return `${date.toLocaleString("en-US", {
                        month: "short",
                      })} ${date.getUTCDate()}`;
                    },
                    label: function (context) {
                      return "‚óè  Units: " + context.parsed.y.toFixed(2);
                    },
                  },
                },
              },
              layout: { padding: 0 },
            },
          });
        }

        // -------------------------
        // Init
        // -------------------------
        setTitleAndHeader();
        populateSidebar();
        document
          .querySelector(".search-bar")
          .addEventListener("input", filterSidebar);
        updateSummaryTable();
        populateDetailedTable();
        createSimpleChart();
      });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/decimal.js@10.3.1/decimal.min.js"></script>
  </body>
</html>
